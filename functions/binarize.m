function I_b = binarize(I)

I = rgb2gray(I);
I_c = edge(I, 'canny');         %detect edges

window = [0 1 1 1 1 1 1 0;...
    1 1 1 1 1 1 1 1;...
    1 1 1 1 1 1 1 1;...
    1 1 1 1 1 1 1 1;...
    1 1 1 1 1 1 1 1;...
    1 1 1 1 1 1 1 1;...
    1 1 1 1 1 1 1 1;...
    0 1 1 1 1 1 1 0];
I_c = imdilate(I_c, window);    %dilate to close outline
I_c = imfill(I_c, 'holes');     %fill in holes
I_c = bwareaopen(I_c, 200);     %erase small regions
I_c = imerode(I_c, window);     %erode back

window = [0 0 1 1 1 1 1 0 0; ...
    0 1 1 1 1 1 1 1 0; ...
    1 1 1 1 1 1 1 1 1; ...
    1 1 1 1 1 1 1 1 1; ...
    1 1 1 1 1 1 1 1 1; ...
    1 1 1 1 1 1 1 1 1; ...
    1 1 1 1 1 1 1 1 1; ...
    0 1 1 1 1 1 1 1 0; ...
    0 0 1 1 1 1 1 0 0];

I_c = imdilate(I_c, window);    %dilate and erode to smooth
I_c = imerode(I_c, window);

I_b = I_c;
